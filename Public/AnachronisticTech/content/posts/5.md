---
date: 03/10/2018
summary: After living for a week with two other computer scientists in a house with rubbish internet bandwidth, I decided it was time to end the YouTube content drought by building a Raspberry Pi-powered portable downloading  device.
type: project
---

# What have I been developing this week? – Portable YouTube Downloader (Pi)

When computer scientists live in the same place it isn’t food or water which are rationed, it’s internet bandwidth. The internet connection speed at our new place is frankly quite poor, meaning we must be considerate towards each other about how and for what we use the internet. What’s worse, even without this constraint, the connection is so rubbish that watching YouTube videos in 1080p is only just about feasible, so forget two people trying simultaneously…

I joked with a roommate of mine that we could use the highspeed connection at our department building to get around this by downloading several videos in one go. Lamenting that most of my downloaders for YouTube had gone extinct over the years, my friend pointed me towards youtube-dl, a free command line utility written in python capable of downloading from single videos to entire playlists from YouTube. Enthused, I downloaded it and tried to download a short video. The program performed as promised, and after a few seconds a new MP4 file was waiting for me on the desktop. I extended the test to my Watch Later playlist, but youtube-dl informed me that no such playlist existed. My friend and I spent a few minutes checking through the extensive documentation online and found we could provide the utility with login credentials. I was a bit sceptical – not least because it meant handing over my password to an unknown tool – but I gave it a try. Kicking into gear, youtube-dl authenticated my login and set to work downloading my list of videos.

With these tests successful I cancelled the download and investigated how to limit the list to start at a certain position. Youtube-dl is incredibly feature-rich and can be configured by providing options in the command line prior to execution, such as “-playlist-start 10" to begin downloading from the tenth video in the playlist. I wrote a quick batch file with all my desired options, loaded it and the utility onto my laptop, and resolved to set the program running when I got to the Computer Science building on campus for a meeting the next day, leaving it running in my bag while I dealt with other things. When I returned home a few hours later I discovered all the videos had been successfully downloaded and saved to a folder, so I could catch upon the antics of my favourite content creators in my own time.

As it happened, that day I had planned to take in my laptop anyway but lugging around a three-kilo laptop for hours just to download some videos didn’t strike me as particularly practical, so the gears in my mind started to churn out ideas and solutions. One possibility was to buy a cheap Windows or Android tablet, stick it in a locker and check it every day (workable, but not ideal). Another idea was to only do this once a week when I would carry my laptop in for other reasons (a decent compromise, but who wants to be left behind on their favourite show?). Then I remembered my old friend, the venerable Raspberry Pi micro-computer. The Raspberry Pi, or Pi for short, is a tiny computer about the size of a bank card. It has its own processor, RAM, an SD-card slot, and USB ports, and is available in several configurations. I have one at home: an original 1st generation model B with four USB ports and an RJ-45 ethernet socket. I could get my hands on it in a few weeks, but there would be problems. This model of Pi requires a Wi-Fi attachment, and is also relatively bulky. I could live with the size, but the Wi-Fi dongle could easily be damaged if the device is constantly being moved around in a heavy bag.

My roommate to the rescue suggested I have a look at newer models of Raspberry Pi, in particular the more modern Zero W version which is far smaller than mine and has Wi-Fi onboard. As a downside, the Zero W has only a single micro-USB for connecting other devices, but since I would only be using a USB for transferring videos, I dismissed this issue. I checked on Amazon and found them clocking in at around £20 and could be delivered as early as the next day! Adding it to my basket, I also had a look for an appropriate SD-card upon which to mount the operating system, and a decently-sized power bank to fuel the contraption. The whole order finished at just over £50 and the parts were slated for delivery the next day.

I considered getting ahead of the game by configuring the operating system using a virtual machine so everything would already be done by the time the parts arrived. I tried using QEMU to emulate the Pi, but the procedure is quite tricky since the Pi uses the ARM processor architecture which is more commonly found in tablets and other lower-power devices. Ultimately, I failed to emulate it, and resorted to waiting for the parts to arrive the next day. Twenty-four hours later I got the Amazon pickup email and set off to collect my gear. In the package was a tiny Pi kit complete with a stylish case, an SD card to mount the operating system, a 32-gb USB drive with an extra micro-connector for interfacing with the Pi, and a rechargeable USB power supply which was about five times larger than the Pi itself. I set up my laptop to burn the OS image onto the card, attached the power brick to charge, and started fitting the Pi into the case. Aside from messing up immediately and realising I couldn’t actually insert the SD card when the Pi was fully enclosed, things were looking up until another issue presented itself: when the power cable was connected, the USB drive was too wide to fit into its slot. Short of dismantling the drive, there was little I could do except return to Amazon and search for an On-The-Go cable – a short micro-USB cable with a full-sized USB port at the end – to eliminate the width issue. I also added a mini-HDMI adapter to the cart, so I wouldn’t be forced into using SSH to configure everything. Still, it meant another day of waiting.

Since in the time between ordering the first batch of tech to the second the nearby Amazon locker had filled up, I awoke the next day to a sharp knocking on the door from the home delivery service. I collected the parcel, tossed the contents into my backpack, and headed off for a full day of lectures. I had planned to use the hot-desk room in the new Computer Science building on campus to set everything up during a break, but it was still in the process of being completed, so it wasn’t until I got home that evening that I could start putting it all into place. I wired the Pi to my monitor and to a powered USB hub to use a keyboard and the USB drive at the same time. With my friend’s assistance, we downloaded the youtube-dl script from GitHub, and set up a quick script to download videos from a playlist we could both add to. We added the script to the end of the .bashrc file so it would be run as soon as the user logged in and set the Pi to automatically login as soon as the power-on sequence had completed. We also included a line at the end of the file to shutdown the Pi when the download process completed so that the battery power wouldn’t be wasted, and so that we could check if the download was complete without plugging the contraption into a monitor.

The two tricky parts to the setup were the wireless network settings and the USB drive. Regarding the wi-fi, it was not difficult to connect the Pi to our network, but we had to provide settings for the campus network to make the endeavour worthwhile, and we wouldn’t have a keyboard or monitor there to see what we were doing. What complicated matters further was that the campus network uses Enterprise-level security with a username and password (as opposed to just a password as with most personal networks). We set up the wpa_supplicant.conf file as best we could, but the only way to test it was to take the Pi to a lecture the next day and see it in action. The other issue revolved around mounting the USB drive to a directory when the Pi booted up and making sure it could be written to. This involved editing the “fstab" file to mount the drive on boot, but we encountered difficulty since the drive used the FAT32 filesystem type. This is quite a common filesystem for small removable drives, but we ran into a problem when attempting to give the script write-permissions since FAT32 does not support permissions at all. Instead we edited the “fstab" file again to mount the drive and access it correctly. As a test, we added a short video to the playlist and set the Pi into gear. It failed during the first attempt due to the system time not updating to the current time – this most likely caused problems for validation of the YouTube certificate, but we corrected the issue with a simple command – and worked the second time except for outputting an MKV file. I’m an old-school person; I prefer my MP4s, so we returned to .bashrc and enabled an option on our script to force the output into an MP4 container.

With the video now downloaded successfully, all that was left was to perform a live test in the wild. Having worked into the small hours of the morning to set up this device, I hopped onto YouTube, added some new videos to the list, and shut everything down for the night to get some well-earned rest. When I arose at a more respectable time that day and left home for a lecture, I took the whole kit – minus the hub, keyboard, and HDMI adapter – with me to the campus, and upon reaching the building, plugged in the power and smiled as the tiny lights began to flicker. Hopefully the network settings were all correct, and in an hour, I could check the contents of the USB drive from my laptop. While not to say that I don’t have confidence in my abilities, I was quite surprised that everything had worked almost flawlessly. Inspecting the drive, two of the three files had downloaded without issue, but one was damaged. After testing the contraption a few more times, I’ve concluded this was simply because the download didn’t have time to complete. Hence, we now have an efficient way of queueing videos from YouTube to download without impacting our limited bandwidth at home using a homemade system that can be held in one hand. Take that, service providers!